{{ $citations := site.Data.citations }}

{{ $types := slice "article" "book" "film" "interview" "podcast" }}

{{ range $type := $types }}
  {{ $items := where $citations "type" $type }}
  {{ if $items }}
    <h2>{{ $type | humanize }}s</h2>
    {{ range $items }}
      <div class="citation-entry" id="{{ .id }}" style="display: flex; gap: 1rem; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid #eee;">
        {{ if .pdf }}
          {{ $pdfPath := .pdf }}
          {{ $coverPath := replaceRE "/[^/]+$" "/cover.jpg" $pdfPath }}
          <div class="citation-cover" style="flex-shrink: 0;">
            <a href="/{{ .pdf }}" target="_blank">
              <img src="/{{ $coverPath }}" alt="{{ .title }}" style="width: 100px; height: auto; border: 1px solid #ddd; border-radius: 4px;">
            </a>
          </div>
        {{ end }}
        <div class="citation-details">
          <div class="citation-title" style="font-weight: 600; margin-bottom: 0.25rem;">
            {{ if .url }}
              <a href="{{ .url }}" target="_blank" rel="noopener">{{ .title }}</a>
            {{ else }}
              {{ .title }}
            {{ end }}
          </div>
          <div class="citation-meta" style="color: #666; font-size: 0.9rem;">
            {{ if .publication }}<em>{{ .publication }}</em>{{ end }}
            {{ if .pages }} 路 pp. {{ .pages }}{{ end }}
            {{ if .authors }} 路 {{ delimit .authors ", " }}{{ end }}
            {{ if .date }} 路 {{ dateFormat "January 2006" .date }}{{ end }}
            {{ if .language }}
              {{ if ne .language "en" }} 路 ({{ .language }}){{ end }}
            {{ end }}
          </div>
          {{ if .abstract }}
            <div class="citation-abstract" style="margin-top: 0.5rem; font-size: 0.9rem;">{{ .abstract }}</div>
          {{ end }}
          {{ if .description }}
            <div class="citation-description" style="margin-top: 0.5rem; font-size: 0.9rem;">{{ .description }}</div>
          {{ end }}
          {{ if .pdf }}
            <div class="citation-pdf" style="margin-top: 0.5rem;">
              <a href="/{{ .pdf }}" target="_blank" style="color: #0066cc; font-size: 0.85rem;"> View PDF</a>
            </div>
          {{ end }}
        </div>
      </div>
    {{ end }}
  {{ end }}
{{ end }}

<!-- Also list any citations without a recognized type -->
{{ $otherItems := where $citations "type" "not in" $types }}
{{ if $otherItems }}
  <h2>Other</h2>
  {{ range $otherItems }}
    <div class="citation-entry" id="{{ .id }}" style="display: flex; gap: 1rem; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid #eee;">
      {{ if .pdf }}
        {{ $pdfPath := .pdf }}
        {{ $coverPath := replaceRE "/[^/]+$" "/cover.jpg" $pdfPath }}
        <div class="citation-cover" style="flex-shrink: 0;">
          <a href="/{{ .pdf }}" target="_blank">
            <img src="/{{ $coverPath }}" alt="{{ .title }}" style="width: 100px; height: auto; border: 1px solid #ddd; border-radius: 4px;">
          </a>
        </div>
      {{ end }}
      <div class="citation-details">
        <div class="citation-title" style="font-weight: 600; margin-bottom: 0.25rem;">
          {{ if .url }}
            <a href="{{ .url }}" target="_blank" rel="noopener">{{ .title }}</a>
          {{ else }}
            {{ .title }}
          {{ end }}
        </div>
        <div class="citation-meta" style="color: #666; font-size: 0.9rem;">
          {{ if .publication }}<em>{{ .publication }}</em>{{ end }}
          {{ if .pages }} 路 pp. {{ .pages }}{{ end }}
          {{ if .date }} 路 {{ dateFormat "January 2006" .date }}{{ end }}
        </div>
        {{ if .abstract }}
          <div class="citation-abstract" style="margin-top: 0.5rem; font-size: 0.9rem;">{{ .abstract }}</div>
        {{ end }}
        {{ if .description }}
          <div class="citation-description" style="margin-top: 0.5rem; font-size: 0.9rem;">{{ .description }}</div>
        {{ end }}
        {{ if .pdf }}
          <div class="citation-pdf" style="margin-top: 0.5rem;">
            <a href="/{{ .pdf }}" target="_blank" style="color: #0066cc; font-size: 0.85rem;"> View PDF</a>
          </div>
        {{ end }}
      </div>
    </div>
  {{ end }}
{{ end }}
