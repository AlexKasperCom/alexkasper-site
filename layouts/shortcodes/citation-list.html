{{ $citations := site.Data.citations }}

{{ $types := slice "article" "book" "film" "interview" "podcast" }}

{{ range $type := $types }}
  {{ $items := where $citations "type" $type }}
  {{ if $items }}
    <h2>{{ $type | humanize }}s</h2>
    {{ range $items }}
      <div class="citation-entry" id="{{ .id }}">
        <div class="citation-title">
          {{ if .url }}
            <a href="{{ .url }}" target="_blank" rel="noopener">{{ .title }}</a>
          {{ else }}
            {{ .title }}
          {{ end }}
        </div>
        <div class="citation-meta">
          {{ if .publication }}{{ .publication }} 路 {{ end }}
          {{ if .publisher }}{{ .publisher }} 路 {{ end }}
          {{ if .authors }}{{ delimit .authors ", " }} 路 {{ end }}
          {{ if .date }}{{ dateFormat "January 2006" .date }}{{ end }}
        </div>
        {{ if .description }}
          <div class="citation-description">{{ .description }}</div>
        {{ end }}
        {{ if .tags }}
          <div class="citation-tags">
            {{ range .tags }}
              <span>{{ . }}</span>
            {{ end }}
          </div>
        {{ end }}
      </div>
    {{ end }}
  {{ end }}
{{ end }}

<!-- Also list any citations without a recognized type -->
{{ $otherItems := where $citations "type" "not in" $types }}
{{ if $otherItems }}
  <h2>Other</h2>
  {{ range $otherItems }}
    <div class="citation-entry" id="{{ .id }}">
      <div class="citation-title">
        {{ if .url }}
          <a href="{{ .url }}" target="_blank" rel="noopener">{{ .title }}</a>
        {{ else }}
          {{ .title }}
        {{ end }}
      </div>
      <div class="citation-meta">
        {{ if .publication }}{{ .publication }} 路 {{ end }}
        {{ if .date }}{{ dateFormat "January 2006" .date }}{{ end }}
      </div>
      {{ if .description }}
        <div class="citation-description">{{ .description }}</div>
      {{ end }}
    </div>
  {{ end }}
{{ end }}
